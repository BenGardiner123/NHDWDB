--///Ben Gardiner 102151272

-- Northen Hospital Database DDL

DROP TABLE IF EXISTS DIMSTAFF;
DROP TABLE IF EXISTS DIMTREATMENT;
DROP TABLE IF EXISTS DIMPATIENT;
DROP TABLE IF EXISTS DIMEASUREMENT;
DROP TABLE IF EXISTS DWEPISODE;
DROP TABLE IF EXISTS DWINTERVENTION;
DROP TABLE IF EXISTS DWTREATING;
DROP TABLE IF EXISTS DWDATE;


CREATE TABLE DIMSTAFF(
	DWDIM_STAFFID INT IDENTITY(1,1) NOT NULL, -- THE SURROGATE KEY
	DWDIM_SOURCEID INT NOT NULL, -- THE HOSPITAL STAFF UNIQUE ID 
	DWDIM_SOURCETABLE INT NOT NULL, -- SOURCE TABLE POTENTIALLY FROM ANOTHER HOSPITAL ("AUSTIN_TREATMENT " OR "RMH-TREATMENT")
	STAFFTYPE NVARCHAR(50) NOT NULL --  E.G. CLINICIAN, NURSE, RESIDENT, ADMIN ETC

	CONSTRAINT PK_DIMSTAFF PRIMARY KEY CLUSTERED (DWDIM_STAFFID ASC)
);


CREATE TABLE DIMTREATMENT(
	DWDIM_TREATMENTID INT IDENTITY(1,1) NOT NULL,  -- THE SURROGATE KY
	DWDIM_SOURCEID INT NOT NULL,  -- THE UNIQUE IDENTIFIER FROM THE SOURCE DB
	DWDIM_SOURCETABLE NVARCHAR(50) NOT NULL, -- SOURCE TABLE POTENTIALLY FROM ANOTHER HOSPITAL ("AUSTIN_TREATMENT " OR "RMH-TREATMENT")
	RECORDTYPE NVARCHAR(50) NOT NULL, -- E.G., MMR, MRI, COVID 
	CATEGORY NVARCHAR(50) NOT NULL --THE CATEGORY THE TREATMENT FALLS UNDER E.G., “IMMUNISATION” 

	CONSTRAINT PK_DIMTREATMENT PRIMARY KEY CLUSTERED (DWDIM_TREATMENTID ASC)
);

CREATE TABLE DIMPATIENT(
	DWDIM_PATIENTID INT IDENTITY(1,1) NOT NULL, -- SURROGATE KEY FOR THE TABLE
	DWDIM_SOURCEID INT NOT NULL,  --ALLOWS FOR OTHER DATABASES TO BE LINKED – TAKING THE PLACE OF URNUMBER HERE 
	DWDIM_SOURCETABLE NVARCHAR(50) NOT NULL,  -- SOURCE TABLE POTENTIALLY FROM ANOTHER HOSPITAL ("AUSTIN" OR "RMH")
	GENDER NVARCHAR(50) NOT NULL, -- M, F, I
	YEAROFBIRTH INT NOT NULL, -- 1908 -- WILL USE DATEPART IN THE ETL TO COMPUTE THE NUMBER FROM A DATETIME
	SUBURB NVARCHAR(50) NOT NULL, -- E.G., “ELTHAM”
	POSTCODE NVARCHAR(4) NOT NULL, -- E.G., 3113, 4578
	COUNTRYOFBIRTH NVARCHAR(50) NOT NULL, --E.G., AUSTRALIA, INDIA 
	PREFERREDLANGUAGE NVARCHAR(50) NOT NULL, --E.G., ENGLISH, PASHTUN
	LIVESALONE BIT NOT NULL, -- 1 OR 0
	ACTIVE BIT NOT NULL, -- 1 OR 0
	DIAGNOSIS NVARCHAR(500) NULL,  --EXPLANATION TO THE PATIENT ABOUT THEIR CONDITION 
	CATEGORYNAME NVARCHAR(50) NOT NULL, --SO, WE CAN ACCESS THE CATEGORY OF ISSUE THEY HAVE E.G., INDWELLING PLEURAL CATHETER, COPD, ASTHMA
	PROCEDUREDATE DATETIME NULL -- 12/12/12 12:23:23:22

	CONSTRAINT PK_DIMAPATIENT PRIMARY KEY CLUSTERED (DWDIM_PATIENTID ASC)
);


CREATE TABLE DIMEASUREMENT(
	DWDIM_MEASUREMENTID INT IDENTITY(1,1) NOT NULL, -- THE SURROGATE KEY
	DWDIM_SOURCETABLE NVARCHAR(50) NOT NULL, -- SOURCE TABLE POTENTIALLY FROM ANOTHER HOSPITAL E.G ("AUSTIN_IPC")
	MEASUREMENTID INT NOT NULL, --THE ID NUMBER RELATED TO EACH MEASUREMENT
	MEASUREMENTNAME NVARCHAR(50) NOT NULL, --THE NAME OF THE MEASUREMENT TO BE TAKEN E.G., ”BREATHLESSNESS”
	DATAPOINTNUMBER INT NOT NULL, --EACH MEASUREMENT HAS EITHER ONE OR MANY DATA POINTS ASSOCIATED WITH IT, E.G., 1, 2, 3
	UPPERLIMIT INT NOT NULL, -- MAX REPORTABLE VALUE, E.G., 100, 600, 5  
	LOWERLIMIT INT NOT NULL, --MIN REPORTABLE VALUE E.G., 1, 0  
	[NAME] NVARCHAR(50) NOT NULL --NAME OF THE DATA POINT MEASUREMENT  MATCHES UP WITH MEASUREMENT NAME E.G., ‘MOBILITY'
	CONSTRAINT PK_DIMMEASUREMENT PRIMARY KEY CLUSTERED (DWDIM_MEASUREMENTID ASC)
);

CREATE TABLE DWEPISODE(
	DWFACT_EPISODEID INT IDENTITY(1,1) NOT NULL, --THE SURROGATE KEY
	DWFACT_EPISODEDATEID INT NOT NULL, --WILL REFER TO A DATE KEY IN THE DWADATE TABLE
	DWDIM_MEASUREMENTID INT NOT NULL, --REFERS TO THE PRIMARY KEY IN THE DIMMEASUREMENT TABLE
	DWDIM_PATIENTID INT NOT NULL, --REFERS TO THE SURROGATE KEY FROM THE PATIENT DIMENSION TABLE 
	DATETIMERECORDED DATETIME NOT NULL, --REFERS TO THE DATE AND TIME THAT THE EPISODE BETWEEN PATIENT AND CLINICIAN OCCURS E.G(2021-09-01 12:12:22.00)
	FREQUENCYSETDATE DATETIME NOT NULL, --REFERS TO THE DATE AND TIME THE CLINICIAN SETS THE FREQUENCY E.G (2021-09-01 12:12:22.00)
	FREQUENCY INT NOT NULL, -- THE NUMBER OF DAYS BETWEEN MEASUREMENTS (31 OR 7 etc..)
	[VALUE] FLOAT(10) NOT NULL, -- ACTUAL VALUE TAKEN E.G (1.0 OR 2.3)
	
	CONSTRAINT PK_FACTEPISODE PRIMARY KEY CLUSTERED (DWFACT_EPISODEID ASC)
);

CREATE TABLE DWINTERVENTION(
	DWFACT_INTERVENTIONID INT IDENTITY(1,1) NOT NULL, -- SURROGATE KEY FOR THIS TABLE 
	DWDATE_INTERVENTIONDATEID INT NOT NULL, -- ID THAT WILL REFERENCE THE KEY FORM DWDATE TABLE
	DWDIM_PATIENTID INT NOT NULL, -- SURROGATE KEY FROM PATIENT TABLE
	DWDIM_TREATMENTID INT, -- SURROGATE KEY FROM TREATMENT TABLE
	NOTES NVARCHAR(MAX), --CLINICIANS NOTES REGARDING THE INTERVENTION E.G., “PATIENT REQUIRES COVID VACCINE ASAP”
	
	CONSTRAINT PK_FACTINTERVENTION PRIMARY KEY CLUSTERED (DWFACT_INTERVENTIONID ASC)
);

CREATE TABLE DWTREATING(
	DWFACT_TREATINGID INT IDENTITY(1,1) NOT NULL, -- SURROGATE KEY
	DWDIM_STAFFID INT NOT NULL,	-- REFERENCES THE STAFF DIMESNSION TABLE 
	DWDIM_PATIENTID INT NOT NULL, -- REFENCES THE PATIENT DIMENSION TABLE
	DWDATE_STARTDATE INT NOT NULL, -- REFERENCES THE DATE KEY FROM THE DATE TABLE 
	DWDATE_ENDDATE INT NULL -- THE END DATE OF THE TREATMENT WILL BE NULL TO BEGIN WITH 
	
	CONSTRAINT PK_FACTTREATING PRIMARY KEY CLUSTERED (DWFACT_TREATINGID ASC)
);

CREATE TABLE DWDATE(   
	DATEKEY INTEGER PRIMARY KEY,  -- 1, 2, 3, further feilds to follow 
 
);

